<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Helicopter Maintenance Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{margin:0;font-family:Arial;background:#f4f6f9}
.hidden{display:none}
header{background:#1e293b;color:#fff;padding:12px 16px;display:flex;justify-content:space-between;flex-wrap:wrap}
.container{padding:16px}
.card{background:#fff;padding:14px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
@media(max-width:900px){.grid{grid-template-columns:1fr}}
label{font-weight:bold;font-size:13px;margin-top:6px;display:block}
input,select,textarea{width:100%;padding:7px;margin-top:4px;border-radius:8px;border:1px solid #cbd5e1}
button{padding:8px 12px;border-radius:8px;border:none;background:#2563eb;color:#fff;font-weight:bold;cursor:pointer}
button:hover{background:#1d4ed8}
table{width:100%;border-collapse:collapse;margin-top:8px}
th,td{border:1px solid #cbd5e1;padding:6px;font-size:12px}
th{background:#e5e7eb}
.small{font-size:12px;color:#64748b}
.click{cursor:pointer}
.click:hover{background:#f1f5f9}
.status{padding:2px 8px;border-radius:999px;font-size:11px;font-weight:bold}
.req{background:#ffedd5;color:#9a3412}
.iss{background:#dbeafe;color:#1e3a8a}
.ins{background:#dcfce7;color:#166534}
.aog{background:#fee2e2;color:#991b1b}
</style>
</head>

<body>

<header id="topBar" class="hidden">
  <div><b id="tbReg">‚Äî</b> | S/N <span id="tbSN">‚Äî</span></div>
  <div>TT <span id="tbTT">‚Äî</span> | TC <span id="tbTC">‚Äî</span></div>
</header>

<!-- PAGE 1 -->
<div id="pageSetup" class="container">
<div class="card">
<h2>üìå Data Entry & Planning</h2>

<div class="grid">
<div>
<label>Aircraft Reg</label><input id="reg">
<label>Serial No</label><input id="sn">
<label>Total Time</label><input id="tt">
<label>Total Cycles</label><input id="tc">
</div>

<div>
<label>Aircraft Inspections</label>
<label><input type="checkbox" value="100 HRS" class="cbAir"> 100 HRS</label>
<label><input type="checkbox" value="4 YEAR" class="cbAir"> 4 YEAR</label>

<label style="margin-top:10px">
<input type="checkbox" id="includeRoutine"> Include Routine Tasks
</label>
</div>
</div>

<button onclick="start()">‚ñ∂ Start Maintenance</button>
</div>
</div>

<!-- PAGE 2 -->
<div id="pageMain" class="container hidden">

<div class="grid">
<div class="card">
<h3>üìä Inspection Progress</h3>
<div id="inspProg"></div>
</div>

<div class="card">
<h3>üë• Team Progress</h3>
<div id="teamProg"></div>
</div>
</div>

<div class="grid" style="margin-top:16px">
<div class="card">
<h3>üßæ Summary</h3>
<table>
<thead><tr><th>Item</th><th>Progress</th></tr></thead>
<tbody id="summary"></tbody>
</table>
</div>

<div class="card">
<h3>üì¶ Parts & Consumables</h3>
<button onclick="exportAOG()" style="margin-bottom:8px;background:#dc2626">
Export AOG Report
</button>
<table>
<thead>
<tr>
<th>Inspection</th>
<th>Item #</th>
<th>Section</th>
<th>Task</th>
<th>P/N</th>
<th>Desc</th>
<th>Qty</th>
<th>Status</th>
</tr>
</thead>
<tbody id="partsTable"></tbody>
</table>
</div>
</div>

<div class="card" style="margin-top:16px">
<h3>üîç Details</h3>
<div id="details" class="small">Select inspection</div>
</div>

</div>

<script>
let items=[],tasks=[];
let SECTIONS=["Fuselage","MR","TR","Engine","Avionics"];

function uid(){return Math.random().toString(36).slice(2,9)}

function start(){
tbReg.textContent=reg.value;
tbSN.textContent=sn.value;
tbTT.textContent=tt.value;
tbTC.textContent=tc.value;

items=[];tasks=[];

document.querySelectorAll(".cbAir:checked").forEach(c=>{
let pid=uid();
items.push({id:pid,label:c.value});
["Fuselage","Engine"].forEach((sec,i)=>{
tasks.push({
id:uid(),
parent:pid,
inspection:c.value,
itemNo:i+1,
section:sec,
title:`${sec} inspection task`,
done:false,
parts:[]
});
});
});

pageSetup.classList.add("hidden");
pageMain.classList.remove("hidden");
topBar.classList.remove("hidden");
render();
}

function render(){
summary.innerHTML="";
items.forEach(it=>{
let st=tasks.filter(t=>t.parent===it.id);
let d=st.filter(t=>t.done).length;
let p=st.length?Math.round(d/st.length*100):0;
summary.innerHTML+=`
<tr class="click" onclick="openDetails('${it.id}')">
<td><b>${it.label}</b></td>
<td>${p}%</td>
</tr>`;
});
renderParts();
renderProg();
}

function openDetails(id){
let html="";
tasks.filter(t=>t.parent===id).forEach(t=>{
html+=`
<div class="card" style="margin-bottom:10px">
<b>Item ${t.itemNo} ‚Äì ${t.section}</b><br>
${t.title}<br>

<label><input type="checkbox" ${t.done?"checked":""}
onchange="t.done=this.checked;render()"> Task Done</label>

<label>Add Part</label>
<div class="grid">
<input placeholder="P/N" id="pn_${t.id}">
<input placeholder="Description" id="ds_${t.id}">
<input type="number" placeholder="Qty" id="qt_${t.id}">
<select id="st_${t.id}">
<option>Requested</option>
<option>Issued</option>
<option>Installed</option>
<option>AOG</option>
</select>
</div>
<button onclick="addPart('${t.id}')">Add</button>
</div>`;
});
details.innerHTML=html;
}

function addPart(tid){
let t=tasks.find(x=>x.id===tid);
let p={
pn:document.getElementById("pn_"+tid).value,
desc:document.getElementById("ds_"+tid).value,
qty:+document.getElementById("qt_"+tid).value||1,
status:document.getElementById("st_"+tid).value
};
t.parts.push(p);
render();
}

function renderParts(){
partsTable.innerHTML="";
tasks.forEach(t=>{
t.parts.forEach(p=>{
partsTable.innerHTML+=`
<tr>
<td>${t.inspection}</td>
<td>${t.itemNo}</td>
<td>${t.section}</td>
<td>${t.title}</td>
<td>${p.pn}</td>
<td>${p.desc}</td>
<td>${p.qty}</td>
<td class="status ${p.status==="AOG"?"aog":""}">${p.status}</td>
</tr>`;
});
});
}

function renderProg(){
inspProg.innerHTML="";
items.forEach(it=>{
let st=tasks.filter(t=>t.parent===it.id);
inspProg.innerHTML+=`<p>${it.label}: ${st.filter(t=>t.done).length}/${st.length}</p>`;
});
teamProg.innerHTML="";
SECTIONS.forEach(s=>{
let st=tasks.filter(t=>t.section===s);
teamProg.innerHTML+=`<p>${s}: ${st.filter(t=>t.done).length}/${st.length}</p>`;
});
}

function exportAOG(){
let map={};
tasks.forEach(t=>{
t.parts.filter(p=>p.status==="AOG").forEach(p=>{
map[p.pn]=(map[p.pn]||0)+p.qty;
});
});
let csv="PN,Quantity\n";
Object.keys(map).forEach(pn=>{
csv+=`${pn},${map[pn]}\n`;
});
let blob=new Blob([csv],{type:"text/csv"});
let a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="AOG_Report.csv";
a.click();
}
</script>

</body>
</html>
