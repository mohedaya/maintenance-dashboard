<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Helicopter Maintenance Dashboard</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body{ margin:0; font-family:Arial, sans-serif; background:#f4f6f9; }
.hidden{ display:none; }

header{
  background:#1e293b;
  color:white;
  padding:12px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
}
header small{ color:#cbd5e1; }

.container{ padding:20px; }

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
}
@media (max-width:900px){
  .grid{ grid-template-columns:1fr; }
}

.card{
  background:white;
  padding:15px;
  border-radius:8px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}

h2{ margin-top:0; }
label{ font-weight:bold; display:block; margin-top:10px; }
input, textarea{ width:100%; padding:6px; margin-top:4px; box-sizing:border-box; }

button{
  margin-top:15px;
  padding:10px 15px;
  background:#2563eb;
  color:white;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
button:hover{ background:#1d4ed8; }

table{ width:100%; border-collapse:collapse; margin-top:10px; }
th, td{ border:1px solid #ccc; padding:6px; }
th{ background:#e5e7eb; }

.done{ color:green; font-weight:bold; }
.notdone{ color:red; font-weight:bold; }

.badge{
  background:#16a34a;
  color:white;
  padding:3px 8px;
  border-radius:6px;
  font-size:12px;
}

.warn{
  background:#fff7ed;
  border:1px solid #fed7aa;
  padding:10px;
  border-radius:8px;
  color:#7c2d12;
}
.small{ font-size:12px; color:#64748b; }
</style>
</head>

<body>

<!-- ================= TOP BAR ================= -->
<header id="topBar" class="hidden">
  <div>
    <b id="tbReg">‚Äî</b>
    <small>
      | TT: <span id="tbTT">‚Äî</span>
      | TC: <span id="tbTC">‚Äî</span>
      | S/N: <span id="tbSN">‚Äî</span>
    </small>
  </div>
  <div>
    <small>Inspections:</small>
    <span id="tbInsp" class="small">‚Äî</span>
  </div>
</header>

<!-- ================= PAGE 1 : SETUP ================= -->
<div id="pageSetup" class="container">

<div class="card">
<h2>üìå Aircraft Data & Planning</h2>

<div class="grid">
<div>
  <label>Aircraft Registration</label>
  <input id="reg">

  <label>Serial Number (S/N)</label>
  <input id="sn">

  <label>Total Time (TT)</label>
  <input id="tt">

  <label>Total Cycles (TC)</label>
  <input id="tc">
</div>

<div>
  <label>Required Inspections (Planning)</label>
  <label><input type="checkbox" value="50 HRS"> 50 HRS</label>
  <label><input type="checkbox" value="100 HRS"> 100 HRS</label>
  <label><input type="checkbox" value="300 HRS"> 300 HRS</label>
  <label><input type="checkbox" value="600 HRS"> 600 HRS</label>
  <label><input type="checkbox" value="1200 HRS"> 1200 HRS</label>
  <label><input type="checkbox" value="2400 HRS"> 2400 HRS</label>
  <label><input type="checkbox" value="1 YEAR"> 1 YEAR</label>
  <label><input type="checkbox" value="2 YEAR"> 2 YEAR</label>
  <label><input type="checkbox" value="4 YEAR"> 4 YEAR</label>

  <label style="margin-top:10px;">
    <input type="checkbox" id="includeRoutine">
    Include Routine Tasks
  </label>
</div>
</div>

<label>Planned Consumables Order</label>
<textarea id="consumables" placeholder="Oil, filters, seals‚Ä¶"></textarea>

<div id="libStatus" class="warn" style="margin-top:12px;">
  Library status: <b>Loading‚Ä¶</b>
</div>

<button id="btnStart" onclick="startMaintenance()" disabled>
‚ñ∂ Start Maintenance
</button>
</div>

</div>

<!-- ================= PAGE 2 : MAIN CONTROL ================= -->
<div id="pageMain" class="container hidden">

<div class="grid">
  <div class="card">
    <h2>üìä Inspection Progress</h2>
    <div id="inspectionProgress" class="small"></div>
  </div>

  <div class="card">
    <h2>üë• Section / Team Progress</h2>
    <div id="sectionProgress" class="small"></div>
  </div>
</div>

<div class="grid">
  <div class="card">
    <h2>üõ† Task Control</h2>

    <input id="taskTitle" placeholder="Task title (manual add)">

    <label>Section / Team</label>
    <select id="section">
      <option>Fuselage / Airframe</option>
      <option>Main Rotor & MGB</option>
      <option>Tail Rotor & Drive</option>
      <option>Engine</option>
      <option>Avionics & Electrical</option>
    </select>

    <label>Task Type</label>
    <select id="taskType">
      <option>Inspection</option>
      <option>Routine</option>
      <option>Non-Routine</option>
    </select>

    <label>NRC # (only if Non-Routine)</label>
    <input id="nrc">

    <button onclick="addTaskManual()">‚ûï Add Task</button>
  </div>

  <div class="card">
    <h2>üìã Tally Sheet</h2>

    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Reference</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="tallyBody"></tbody>
    </table>

    <button onclick="markLastDone()">‚úî Mark Last Task Done</button>
  </div>
</div>

</div>

<script>
let library=null;
let inspections=[];
let tasks=[];

const SECTIONS=[
  "Fuselage / Airframe",
  "Main Rotor & MGB",
  "Tail Rotor & Drive",
  "Engine",
  "Avionics & Electrical"
];

async function loadLibrary(){
  try{
    const r=await fetch("inspection_library.json",{cache:"no-store"});
    library=await r.json();
    libStatus.innerHTML="Library status: <b>Loaded ‚úÖ</b>";
    btnStart.disabled=false;
  }catch{
    libStatus.innerHTML="Library status: <b>NOT FOUND ‚ùå</b>";
  }
}

function startMaintenance(){
  inspections=[];
  tasks=[];

  document.querySelectorAll('#pageSetup input[type=checkbox]:checked')
    .forEach(c=>{
      if(c.value) inspections.push(c.value);
    });

  tbReg.innerText=reg.value||"‚Äî";
  tbSN.innerText=sn.value||"‚Äî";
  tbTT.innerText=tt.value||"‚Äî";
  tbTC.innerText=tc.value||"‚Äî";
  tbInsp.innerText=inspections.join(", ");

  // Load inspection tasks
  inspections.forEach(ins=>{
    const d=library.aircraft_inspections?.[ins];
    if(!d) return;
    Object.keys(d.sections).forEach(sec=>{
      d.sections[sec].forEach(t=>{
        tasks.push({
          title:t.title,
          type:"Inspection",
          section:sec,
          inspection:ins,
          nrc:"",
          done:false
        });
      });
    });
  });

  // Load routine tasks if selected
  if(includeRoutine.checked){
    library.routine_tasks.forEach(rt=>{
      tasks.push({
        title:rt.title,
        type:"Routine",
        section:rt.section,
        inspection:null,
        nrc:"",
        done:false
      });
    });
  }

  pageSetup.classList.add("hidden");
  pageMain.classList.remove("hidden");
  topBar.classList.remove("hidden");

  renderTally();
  calculateProgress();
}

function addTaskManual(){
  if(!taskTitle.value) return;
  tasks.push({
    title:taskTitle.value,
    type:taskType.value,
    section:section.value,
    inspection:null,
    nrc:(taskType.value==="Non-Routine"?nrc.value:""),
    done:false
  });
  taskTitle.value="";
  nrc.value="";
  renderTally();
  calculateProgress();
}

function markLastDone(){
  if(tasks.length===0) return;
  tasks[tasks.length-1].done=true;
  renderTally();
  calculateProgress();
}

function renderTally(){
  let i=1;
  tallyBody.innerHTML="";
  inspections.forEach(ins=>{
    tallyBody.innerHTML+=`
      <tr><td>${i++}</td><td>${ins} Inspection</td><td>‚ùå</td></tr>`;
  });
  tasks.forEach(t=>{
    tallyBody.innerHTML+=`
      <tr>
        <td>${i++}</td>
        <td>${t.type==="Non-Routine"?"NRC "+t.nrc+" ‚Äì ":""}${t.title}</td>
        <td class="${t.done?"done":"notdone"}">${t.done?"‚úî":"‚ùå"}</td>
      </tr>`;
  });
}

function calculateProgress(){
  inspectionProgress.innerHTML="";
  inspections.forEach(ins=>{
    const it=tasks.filter(t=>t.type==="Inspection"&&t.inspection===ins);
    const d=it.filter(t=>t.done).length;
    inspectionProgress.innerHTML+=`
      <p><b>${ins}</b>: ${it.length?Math.round(d/it.length*100):0}%</p>`;
  });

  sectionProgress.innerHTML="";
  SECTIONS.forEach(sec=>{
    const st=tasks.filter(t=>t.section===sec);
    const d=st.filter(t=>t.done).length;
    sectionProgress.innerHTML+=`
      <p><b>${sec}</b>: ${st.length?Math.round(d/st.length*100):0}%</p>`;
  });
}

loadLibrary();
</script>

</body>
</html>
